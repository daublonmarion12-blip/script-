-- Commande de chargement intégrée
-- loadstring(game:HttpGet("https://raw.githubusercontent.com/daublonmarion12-blip/script-/main/MM2"))()

local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Window = Fluent:CreateWindow({
    Title = "MM2 FINAL - CONFIG A",
    SubTitle = "Gauche: A | ESP Wallhack Infaillible",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = { 
    Main = Window:AddTab({ Title = "Visuals", Icon = "eye" }),
    Farm = Window:AddTab({ Title = "Farming", Icon = "coins" }),
    Move = Window:AddTab({ Title = "Mouvement", Icon = "run" })
}

local lp = game.Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local TS = game:GetService("TweenService")

--- VARIABLES ---
local FlySpeed = 50
local FarmSpeed = 20
local CurrentTween = nil

--- ESP WALLHACK (BILLBOARD - TRAVERSE TOUT) ---
local EspToggle = Tabs.Main:AddToggle("RoleESP", {Title = "ESP Wallhack", Default = false})

local function CreateESP(player)
    if player == lp then return end
    local function apply()
        local char = player.Character or player.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart", 10)
        if not hrp then return end
        if hrp:FindFirstChild("ESP_Fix") then hrp.ESP_Fix:Destroy() end

        local b = Instance.new("BillboardGui", hrp)
        b.Name = "ESP_Fix"
        b.AlwaysOnTop = true 
        b.Size = UDim2.new(4, 0, 5.5, 0)
        
        local f = Instance.new("Frame", b)
        f.Size = UDim2.new(1, 0, 1, 0)
        f.BackgroundTransparency = 0.5
        f.BorderSizePixel = 0

        task.spawn(function()
            while b and b.Parent do
                if not EspToggle.Value then b:Destroy() break end
                if player.Backpack:FindFirstChild("Knife") or char:FindFirstChild("Knife") then
                    f.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
                elseif player.Backpack:FindFirstChild("Gun") or char:FindFirstChild("Gun") then
                    f.BackgroundColor3 = Color3.fromRGB(0, 0, 255)
                else
                    f.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
                end
                task.wait(0.5)
            end
        end)
    end
    apply()
    player.CharacterAdded:Connect(apply)
end

EspToggle:OnChanged(function()
    if EspToggle.Value then
        for _, p in pairs(game.Players:GetPlayers()) do CreateESP(p) end
    else
        for _, p in pairs(game.Players:GetPlayers()) do
            if p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                local e = p.Character.HumanoidRootPart:FindFirstChild("ESP_Fix")
                if e then e:Destroy() end
            end
        end
    end
end)

--- FLY (GAUCHE = A) ---
local Flying = false
local FlyToggle = Tabs.Move:AddToggle("FlyToggle", {Title = "Activer le Fly", Default = false})

Tabs.Move:AddSlider("FlySpeed", {
    Title = "Vitesse du Vol",
    Min = 10, Max = 250, Default = 50, Rounding = 0,
    Callback = function(v) FlySpeed = v end
})

task.spawn(function()
    while true do
        task.wait()
        if Flying and lp.Character and lp.Character:FindFirstChild("HumanoidRootPart") then
            local root = lp.Character.HumanoidRootPart
            local cam = workspace.CurrentCamera.CFrame
            local dir = Vector3.new(0,0,0)

            for _, p in pairs(lp.Character:GetDescendants()) do
                if p:IsA("BasePart") then p.CanCollide = false end
            end

            if UIS:IsKeyDown(Enum.KeyCode.W) then dir = dir + cam.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.S) then dir = dir - cam.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.A) then dir = dir - cam.RightVector end -- TOUCHE A GAUCHE
            if UIS:IsKeyDown(Enum.KeyCode.D) then dir = dir + cam.RightVector end
            if UIS:IsKeyDown(Enum.KeyCode.Space) then dir = dir + Vector3.new(0, 1, 0) end
            if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then dir = dir - Vector3.new(0, 1, 0) end

            root.Velocity = dir * FlySpeed
            local bg = root:FindFirstChild("FlyGyro") or Instance.new("BodyGyro", root)
            bg.maxTorque = Vector3.new(9e9, 9e9, 9e9); bg.cframe = cam
        elseif lp.Character and lp.Character:FindFirstChild("HumanoidRootPart") then
            if lp.Character.HumanoidRootPart:FindFirstChild("FlyGyro") then lp.Character.HumanoidRootPart.FlyGyro:Destroy() end
        end
    end
end)

FlyToggle:OnChanged(function() Flying = FlyToggle.Value end)

--- COIN FARM GLISSÉ ---
local FarmToggle = Tabs.Farm:AddToggle("AutoFarm", {Title = "Activer le Coin Farm", Default = false})

Tabs.Farm:AddSlider("FarmSpeed", {
    Title = "Vitesse de Glissade",
    Min = 5, Max = 60, Default = 20, Rounding = 0,
    Callback = function(v) FarmSpeed = v end
})

task.spawn(function()
    while true do
        task.wait(0.1)
        if FarmToggle.Value and lp.Character and lp.Character:FindFirstChild("HumanoidRootPart") then
            for _, v in pairs(workspace:GetDescendants()) do
                if not FarmToggle.Value then break end
                if (v.Name == "CoinVisual" or v.Name == "Coin") and v:IsA("BasePart") and v.Transparency < 1 then
                    local root = lp.Character.HumanoidRootPart
                    local dist = (root.Position - v.Position).Magnitude
                    if dist < 600 then
                        CurrentTween = TS:Create(root, TweenInfo.new(dist/FarmSpeed, Enum.EasingStyle.Linear), {CFrame = v.CFrame})
                        CurrentTween:Play()
                        CurrentTween.Completed:Wait()
                        task.wait(0.2)
                    end
                end
            end
        else
            if CurrentTween then CurrentTween:Cancel() end
        end
    end
end)

Fluent:Notify({Title = "MM2 Script", Content = "Chargement terminé !", Duration = 5})
